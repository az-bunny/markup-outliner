{"version":3,"sources":["index.js","../node_modules/parcel-bundler/src/builtins/bundle-url.js","../node_modules/parcel-bundler/src/builtins/css-loader.js"],"names":["cssLinks","document","querySelectorAll","forEach","link","parent","parentElement","removeChild","styledElements","element","removeAttribute","sectioningTagNames","tagName","htmlCollection","getElementsByTagName","Object","keys","key","idAttr","getAttribute","roleAttr","setAttribute","bookmarklet","createElement","rel","href","head","appendChild","igureClassName","figureElements","imgElements","classList","add","img","container","insertBefore","nextSibling","firstChild","alt","textContent","bundleURL","getBundleURLCached","getBundleURL","Error","err","matches","stack","match","getBaseURL","url","replace","exports","bundle","require","updateLink","newLink","cloneNode","onload","remove","split","Date","now","parentNode","cssTimeout","reloadCSS","setTimeout","links","i","length","module"],"mappings":"ACAA,ACAA,IDAIwC,ACAAY,MAAM,GDAG,ACAAC,GDAG,IAAhB,ACAoB,CAAC,cAAD,CAApB;;ADCA,ACCA,AFFA,SCCSZ,ACCAa,UAAT,CAAoBlD,IAApB,EAA0B,CDD1B,GAA8B;AAC5B,ACCA,MDDI,ACCAmD,CDDCf,MCCM,GDDX,ACCcpC,EDDE,ECCE,CAACoD,SAAL,EAAd;ADAEhB,ADDJ,ICCIA,SAAS,GAAGE,YAAY,EAAxB;AACD,ACADa,AFDA,EECAA,IFDMvD,GECC,CAACyD,IFDM,EECd,CFDiBxD,EECA,MFDQ,CAACC,KECG,WFDZ,CAA0B,4CAA1B,CAAjB;AEEEE,AFDFJ,EAAAA,EECEI,IAAI,CAACsD,CFDC,CAACvD,IECP,GFDF,CAAiB,UAAAC,IAAI,EAAI;ACEzB,ACAC,AFDC,GEDF,KFCQC,CCCDmC,KDDO,GAAGpC,CCCjB,GDDqB,CAACE,aAApB;ACEH,ADDGD,IAAAA,MAAM,CAACE,WAAP,CAAmBH,IAAnB;AECFmD,AFAC,EEADA,CFHA,MEGO,CAAC9B,IAAR,GAAerB,IAAI,CAACqB,IAAL,CAAUkC,KAAV,CAAgB,GAAhB,EAAqB,CAArB,IAA0B,GAA1B,GAAgCC,IAAI,CAACC,GAAL,EAA/C;ADEF,ACDEzD,AFAD,EEACA,IAAI,CAAC0D,EDCEpB,QCDP,CAAgBP,GDClB,GAAwB,MCDtB,CAA6BoB,OAA7B,EAAsCnD,IAAI,CAACgC,WAA3C;ADEA,ACDD,AFCD;ACCE,ADAA,MCAI,ADAE5B,cAAc,GAAGP,QAAQ,CAACC,gBAAT,CAA0B,SAA1B,CAAvB;ACCE,ACDJ,AFCEM,EAAAA,EEDEuD,MDCM,IAAIpB,ACDA,EFCE,CEDC,AFCAxC,ECAP,EAAN,ACDJ,GFCE,CAAuB,UAAAM,OAAO,EAAI;ACCjC,ADACA,GCFF,CAEE,ADAAA,OCAOmC,ADAA,CAAClC,ECAR,EAAY,WDAZ,CAAwB,OAAxB;ACCA,ACFJ,AFEG,GAFD,KCEMmC,CCFCmB,MDEM,GAAG,ACFlB,CDEmB,ECFE,GDEGpB,GAAG,CAACE,KAAV,EAAiBC,KAAjB,CAAuB,+DAAvB,CAAd;ACDF,AFED,EAED,IEJMgB,UAAJ,EAAgB;ADEd,ACDA,QDCIlB,OAAJ,EAAa;AACX,ACDH,AFGH,aCFaG,UAAU,CAACH,OAAO,CAAC,CAAD,CAAR,CAAjB;AACD,ADEH,MAAMlC,kBAAkB,GAAG,CACzB,QADyB,EAEzB,MAFyB,EAGzB,QAHyB,EAIzB,KAJyB,EAKzB,SALyB,EAMzB,SANyB,EAOzB,OAPyB,CAA3B;ACDC,ACDDoD,AFYApD,EEZAoD,AFYApD,UEZU,GAAGsD,KFYK,CAAC9D,IEZI,CAAC,EFYxB,CAA2B,SEZS,CFYTS,OAAO,EAAI;AEXpC,AFYA,QEZIsD,AFYErD,KEZG,GAAGZ,MFYQ,EEZA,CAACC,AFYED,QAAQ,CAACa,OEZpB,CAA0B,YFYf,CAA8BF,OAA9B,CAAvB,GEZY,CAAZ;ADEF,ADYEG,IAAAA,KCZK,CDYC,CAACC,CCZT,GDYE,CAAYH,cAAZ,EAA4BV,OAA5B,CAAoC,UAACc,GAAD,EAAS;ACXhD,ACFG,AFcE,SEdG,CFcGR,GEdC0D,CAAC,GAAG,AFcE,CEdf,EAAgBA,AFcEtD,CEdD,GAAGqD,KAAK,CAACE,IFcM,CAACnD,CEdjC,EAAkCkD,AFcF,CEdG,AFcjC,EEdF,EAAuC;AACrC,AFcA,UEdIf,AFcElC,MEdI,AFcE,CEdD8B,EFcIvC,OAAO,CEdlB,AFcmBU,CEdD+C,KAAK,CAACC,CAAD,CAAL,CAAS1C,EFchB,CAAqB,CEdhC,GFcW,CAAf,EEdyC2B,MAAM,CAACV,YAAP,EAAzC,EAAgE;ADGtE,ACFQY,AFcF,QEdEA,CDECN,CDYG5B,QEdM,AFcE,CCZpB,ACFmB8C,CDECjB,CDYGxC,ECZvB,CCFwB,CDEC,ACFA0D,CAAD,CAAN,CAAV,AFcsB,CAAChD,YAAR,CAAqB,MAArB,CAAjB;ACXJ,ACFK,SDEE,CAAC,KAAK8B,GAAN,EAAWC,OAAX,CAAmB,sEAAnB,EAA2F,IAA3F,IAAmG,GAA1G;AACD,ACFI,AFaC,UAAGhC,MAAH,EAAW;AACTT,QAAAA,OAAO,CAACY,YAAR,CAAqB,SAArB,mBAAyCH,MAAzC;ACVRiC,ACFIY,AFaG,IEbHA,GDEG,CAACrB,MCFM,GAAG,GDEjB,CCFI,EDEmBD,kBAAvB;AACAU,ACFG,GATsB,EASpB,EDEE,ACXkB,CDWjBH,ACXN,UDWF,GAAqBA,UAArB;ACDC,AFYK,UAAG5B,QAAH,EAAa;AACXX,QAAAA,OAAO,CAACY,YAAR,CAAqB,WAArB,qBAA6CD,QAA7C;AEXRiD,AFYO,MEZD,CAAClB,OAAP,GAAiBa,SAAjB;AFaK,KAVD;AAWD,GAdD;AAeD;AAED;AACE,MAAM1C,WAAW,GAAGrB,QAAQ,CAACsB,aAAT,CAAuB,MAAvB,CAApB;AACAD,EAAAA,WAAW,CAACE,GAAZ,GAAkB,YAAlB;AACAF,EAAAA,WAAW,CAACG,IAAZ,GAAmB,8CAAnB;AACAxB,EAAAA,QAAQ,CAACyB,IAAT,CAAcC,WAAd,CAA0BL,WAA1B;AACD,EAED;;AACA;AACE,MAAMM,cAAc,GAAG,iBAAvB;AAEA,MAAMC,cAAc,GAAG5B,QAAQ,CAACa,oBAAT,CAA8B,QAA9B,CAAvB;AACAC,EAAAA,MAAM,CAACC,IAAP,CAAYa,cAAZ,EAA4B1B,OAA5B,CAAoC,UAAAc,GAAG,EAAI;AACzC,QAAMa,WAAW,GAAGD,cAAc,CAACZ,GAAD,CAAd,CAAoBH,oBAApB,CAAyC,KAAzC,CAApB;AACAC,IAAAA,MAAM,CAACC,IAAP,CAAYc,WAAZ,EAAyB3B,OAAzB,CAAiC,UAAAc,GAAG,EAAI;AACtCa,MAAAA,WAAW,CAACb,GAAD,CAAX,CAAiBc,SAAjB,CAA2BC,GAA3B,CAA+BJ,cAA/B;AACD,KAFD;AAGD,GALD;AAOA,MAAME,WAAW,GAAG7B,QAAQ,CAACC,gBAAT,oBAAsC0B,cAAtC,OAApB;AACAE,EAAAA,WAAW,CAAC3B,OAAZ,CAAoB,UAAA8B,GAAG,EAAI;AACzB,QAAMC,SAAS,GAAGjC,QAAQ,CAACsB,aAAT,CAAuB,KAAvB,CAAlB;AACAU,IAAAA,GAAG,CAAC3B,aAAJ,CAAkB6B,YAAlB,CAA+BD,SAA/B,EAA0CD,GAAG,CAACG,WAA9C;AACAF,IAAAA,SAAS,CAACH,SAAV,CAAoBC,GAApB,CAAwB,cAAxB;AACAE,IAAAA,SAAS,CAACC,YAAV,CAAuBF,GAAvB,EAA4BC,SAAS,CAACG,UAAtC;;AAEA,QAAGJ,GAAG,CAACd,YAAJ,CAAiB,KAAjB,CAAH,EAA4B;AAC1B,UAAMmB,GAAG,GAAGrC,QAAQ,CAACsB,aAAT,CAAuB,GAAvB,CAAZ;AACAe,MAAAA,GAAG,CAACC,WAAJ,GAAkBN,GAAG,CAACd,YAAJ,CAAiB,KAAjB,CAAlB;AACAe,MAAAA,SAAS,CAACC,YAAV,CAAuBG,GAAvB,EAA4BL,GAAG,CAACG,WAAhC;AACD;AACF,GAXD;AAYD","file":"index.js","sourceRoot":"../src","sourcesContent":["import './bookmarklet.scss'\n\n{\n  const cssLinks = document.querySelectorAll('[rel=\\'stylesheet\\'], [type=\\'text\\/css\\']');\n  cssLinks.forEach(link => {\n    const parent = link.parentElement;\n    parent.removeChild(link);\n  });\n}\n\n{\n  const styledElements = document.querySelectorAll('[style]');\n  styledElements.forEach(element => {\n    element.removeAttribute('style');\n  });\n}\n\n// IDとrole属性値付与\n{\n  const sectioningTagNames = [\n    'header',\n    'main',\n    'footer',\n    'nav',\n    'section',\n    'article',\n    'aside',\n  ];\n\n  sectioningTagNames.forEach(tagName => {\n    const htmlCollection = document.getElementsByTagName(tagName);\n    \n    Object.keys(htmlCollection).forEach((key) => {\n      const element = htmlCollection[key];\n      const idAttr = element.getAttribute('id');\n      const roleAttr = element.getAttribute('role');\n      if(idAttr) {\n        element.setAttribute('data-id', ` [id=\"${idAttr}]`);\n      }\n      if(roleAttr) {\n        element.setAttribute('data-role', ` [role=\"${roleAttr}]`);\n      }\n    });\n  });\n}\n\n{\n  const bookmarklet = document.createElement('link');\n  bookmarklet.rel = 'stylesheet';\n  bookmarklet.href = 'http://sectioning-outliner.io/dist/index.css';\n  document.head.appendChild(bookmarklet);\n}\n\n// img要素周辺を生成\n{\n  const igureClassName = 'igureAltReplace';\n\n  const figureElements = document.getElementsByTagName('figure');\n  Object.keys(figureElements).forEach(key => {\n    const imgElements = figureElements[key].getElementsByTagName('img');\n    Object.keys(imgElements).forEach(key => {\n      imgElements[key].classList.add(igureClassName);\n    });\n  });\n\n  const imgElements = document.querySelectorAll(`img:not(.${igureClassName})`);\n  imgElements.forEach(img => {\n    const container = document.createElement('div');\n    img.parentElement.insertBefore(container, img.nextSibling);\n    container.classList.add('ImgContainer');\n    container.insertBefore(img, container.firstChild);\n\n    if(img.getAttribute('alt')) {\n      const alt = document.createElement('p');\n      alt.textContent = img.getAttribute('alt');\n      container.insertBefore(alt, img.nextSibling);\n    }\n  });\n}\n","var bundleURL = null;\nfunction getBundleURLCached() {\n  if (!bundleURL) {\n    bundleURL = getBundleURL();\n  }\n\n  return bundleURL;\n}\n\nfunction getBundleURL() {\n  // Attempt to find the URL of the current script and use that as the base URL\n  try {\n    throw new Error;\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\\/\\/[^)\\n]+/g);\n    if (matches) {\n      return getBaseURL(matches[0]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\n","var bundle = require('./bundle-url');\n\nfunction updateLink(link) {\n  var newLink = link.cloneNode();\n  newLink.onload = function () {\n    link.remove();\n  };\n  newLink.href = link.href.split('?')[0] + '?' + Date.now();\n  link.parentNode.insertBefore(newLink, link.nextSibling);\n}\n\nvar cssTimeout = null;\nfunction reloadCSS() {\n  if (cssTimeout) {\n    return;\n  }\n\n  cssTimeout = setTimeout(function () {\n    var links = document.querySelectorAll('link[rel=\"stylesheet\"]');\n    for (var i = 0; i < links.length; i++) {\n      if (bundle.getBaseURL(links[i].href) === bundle.getBundleURL()) {\n        updateLink(links[i]);\n      }\n    }\n\n    cssTimeout = null;\n  }, 50);\n}\n\nmodule.exports = reloadCSS;\n"]}